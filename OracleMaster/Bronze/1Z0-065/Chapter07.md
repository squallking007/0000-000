# 第七章 ユーザーおよびセキュリティの管理

## 7.1 ユーザーの管理とセキュリティの管理

**ユーザーアカウントの作成　★★★★**

- `ユーザー属性`情報は`SYSTEM表領域`の**データディクショナリ**に格納されます。

|ユーザー属性 |説明 |
|---- |---- |
|名前 |ユーザーアカウントを識別する名前。**ユーザー名**という。 |
|データベース認証パスワード |ユーザー名対する**パスワード**。<br>パスワードはデータディクショナリに**暗号化**されて格納される。<br>Oracle Database 12cでは、大文字・小文字が区別される。 |
|デフォルト表領域 |ユーザーがオブジェクトを作成する際に、そのオブジェクトの格納先を指定しなかった場合に使用される表領域。<br>デフォルト表領域を指定しない場合は、**デフォルトの永続表領域**が暗黙的に設定される。 |
|一時表領域 |ユーザーが「**一時セグメントの作成を必要とするSQL文**」を実行した際に使用される表領域。<br>一時表領域を指定しない場合はデフォルトの一時表領域が暗黙的に指定される。 |
|表領域の割当て制限 |ユーザーに対して、使用を許可する**表領域の容量**。<br>ユーザーが使用可能な表領域ごとに設定する。<br>`一時表領域`や`UNDO表領域`は割当て制限の設定がなくても**使用できる**。 |
|アカウントステータス<br>(ロックまたはロック解除) |ログインできる状態(**ロック解除**)、またはログイン禁止の状態(**ロック**)を指定する。<br>ロックされている場合は、データベース管理者がロックを解除する必要がある。 |
|パスワードステータス<br>(有効または無効) |パスワードを無効(**期限切れ**)にするか、有効にするかを指定する。<br>**無効になった場合、次回のログイン時にパスワードを変更する必要がある。** |

- データベース管理者は、ユーザーアカウントをあらかじめデータベースに作成しておく。

- ユーザーがデータベースにアクセスするには、接続時に有効なユーザー名、パスワードを入力し、データベースで認証を受ける必要がある。

- 新しく作成したユーザーアカウントを使用してデータベースに接続するには、**CREATE SESSIONシステム権限**が付与されているひつようがある。

- `EM Express`または`SQL文`を使用し、ユーザーアカウントを作成できる。

- SQL文でユーザーアカウントの作成

```SQL
CREATE USER ユーザー名
    IDENTIFIED BY パスワード
    [DEFAULT TABLESPACE 表領域名]
    [TEMPORARY TABLESPACE 表領域名]
    [QUOTA サイズ ON 表領域名]
    [PROFILE プロファイル];
```

- 主な事前定義された管理者アカウント一覧

|ユーザー名 |説明 |
|---- |---- |
|SYS |データベース管理者アカウント<br>データベースの管理情報を格納するデータディクショナリのすべての実表とビューを所有する。 |
|SYSTEM |データベース管理者アカウント。<br>管理情報を表示する表やビュー、Oracleデータベースのオブジェクトやツールで使用する内部的な表やビューを所有する。 |
|SYSMAN |Enterprise Managerによるデータベース操作を実行するためのユーザーアカウント。 |
|DBSMNP |Enterprise Managerの管理エージェントがデータベースの監視および管理を行うために使用するユーザーアカウント。 |

- 「SYS」、「SYSTEM」、「SYSMAN」、「DBSMNP」の４つの`管理者アカウント`は**データベース作成時に自動的に作成される**。

- データベース作成時に`サンプルスキーマ`を作成すると、「`HR`(Human Resources)」、「`OE`(Order Entry)」、「`SH`(Sales History)」などの**サンプルスキーマユーザー**が作成されます。

**ユーザー属性の変更　★★★★**

- `ユーザー属性`は、`ユーザーアカウント`の作成後に**変更できます**。

- `EM Express`または`SQL文`を使用した、ユーザー属性を変更できる。

- SQL文を使用したユーザー属性の変更

```SQL
ALTER USER ユーザー名
    [IDENTIFIED BY パスワード]
    [DEFAULT TABLESPACE 表領域名]
    [TEMPORARY TABLESPACE 表領域名]
    [QUOTA サイズ ON 表領域名]
    [PROFILE プロファイル];
```

**ユーザーアカウントの削除　★★★★**

- `ユーザーアカウント`を削除すると、**ユーザー名が所有していた表や索引などのすべてのオブジェクトも削除されます**。

- `EM Express`または`SQL文`を使用した、ユーザーアカウントを削除できる。

- SQL文を使用したユーザーアカウントの削除

```SQL
DROP USER ユーザー名 [CASCADE];
```

- 削除しようとしているユーザーがデータベースへ接続中の場合は**エラーが表示**され、**削除できない**。

- 削除しようとしているユーザーがオブジェクトを所有している場合は、**所有するオブジェクトをすべて削除する**か、「`CASCADE`」を指定しないと削除できない。

**ユーザーアカウントのロック／ロック解除　★★★**

- `EM Express`または`SQL文`を使用した、ユーザーアカウントをロック／ロック解除できる。

- SQL文を使用したユーザーアカウントのロックおよびロック解除

```SQL
-- ロックの設定
ALTER USER ユーザー名 ACCOUNT LOCK;

-- ロックの解除
ALTER USER ユーザー名 ACCOUNT UNLOCK;
```

- ユーザーアカウントをロックして、特定のユーザーアカウントによるデータベースへのアクセスを一時的に拒否することができる。

- ロックされているユーザーアカウントで接続したい場合は、管理者がロックを解除する必要がある。

**パスワードポリシー　★★★**

- パスワードポリシーによって、ユーザーに対して最低文字数や有効期限といった、**パスワードに関するルール**を設定できる。

- ユーザーアカウントを作成すると、「`プロファイル`」というデータベースオブジェクトを介して、デフォルトのパスワードポリシーが自動的に割当てられる。

- `プロファイル`は、ユーザーには**必ず１つ**のプロファイルが割当てられる。明示的に割当てられていない場合は、「`DEFAULT`」という名前のプロファイルが割当てられる。

- デフォルトのパスワードポリシーは下記のような設定になっています。

  + ユーザーアカウントのパスワードは**180日**で自動的に期限切れとなる。

  + パスワードの期限切れの後、最初にログインした**７日後**にユーザーアカウントがロックされるので、最初のログイン後７日以内にパスワードを変更する必要がある。

  + ログインに**１０回**失敗すると、ユーザーアカウントが**１日**ロックされる。

- `EM Express`を使用してデフォルトのパスワードポリシーを変更できる。

## 7.2 データベース操作のための権限付与

**データベースにおける権限　★★★★**

- `権限`は、**ユーザーによるデータベース操作を制御**するために使用します。

- 権限の種類

|権限 |説明 |
|---- |---- |
|システム権限 |**特定のデータベース操作の実行**を許可するために使用する。 |
|オブジェクト権限 |**特定のデータベースオブジェクトへのアクセス**を制御するために使用する。 |

**管理権限　★★★★**

- 管理権限とは、データベースの作成、インスタンスの起動／停止の実行、バックアップ／リカバリの特別な管理操作を実行するために必要な権限。

- 管理権限はSYSDBA、SYSOPER、SYSBACKUPなどの特別なシステム権限によって付与される。

- 管理権限

|権限名 |説明 |
|---- |---- |
|**SYSDBA システム権限** |すべての権限を持つデータベース管理者用のシステム権限。 |
|**SYSOPER システム権限** |基本的な管理タスクを実行するユーザー用のシステム権限。<br>`インスタンス`の起動／停止はできるが、**データベースの作成やユーザーデータの表示などはできない**。 |

- `SYSDBAシステム権限`が最も強い権利権限であり、他の管理権限は管理操作の一部を実行できる管理権限だある。

- Oracle Database 12cで追加された管理権限

|権限名 |説明 |
|---- |---- |
|SYSBACKUP システム権限 |バックアップおよびリカバリ操作の実行。 |
|SYSDG システム権限 |Data Guard操作の実行。 |
|SYSKM システム権限 |透過的なデータ暗号化キーストア操作の実行。 |

- 管理権限を使用して接続と、一般ユーザーとしての接続では**認証方法が異なります**。管理権限を使用して接続すると、ユーザーはデータベースが**オープンされていない場合でも、インスタンスへのアクセスが許可される**。

- 管理権限を使用した接続の認証方法

|認証方法 |説明 |
|---- |---- |
|**OS認証** |OSのグループによって認証を行う方法。<br>データベースと同じマシン上で、データベースを管理する場合に使用する。 |
|**パスワードファイル認証** |Oracleデータベース外にパスワードファイルを作成することによって認証を行う方法。<br>単一のリモートクライアントから複数のデータベースおｗ管理する場合に使用する。 |

- OS認証で接続
```SQL
connect / as sysdba
```
- パスワードファイル認証で接続
```SQL
connect ユーザー名/パスワード as sysdba
```

- `SYSDBA`として接続するには、ユーザー名/パスワードの指定の際に「**AS SYSDBA**」を指定する。

- `SYSDBA`として接続すると、指定したユーザー名に関連付けられているスキーマではなく、「`SYS`」として接続される。

- `SYS`ユーザーはディクショナリの表所有者であり、権限が無制限になるので、管理作業には注意が必要である。

**権限の付与と取り消し　★★★★**

- `EM Express`または`SQL文`を使用した権限を付与／取消しできます。

- SQL文を使用したシステム権限の付与

```SQL
GRANT システム権限 TO {ユーザー名 | ロール名 | PUBLIC} [WITH ADMIN OPTION];

-- PUBLICはすべてのユーザーを含むユーザーグループです。
-- WITH ADMIN OPTION を指定すると、その権限が付与されたユーザーで、第三者のユーザーに同じ権限を付与できる。
```

- SQL文を使用したオブジェクト権限の付与

```SQL
GRANT オブジェクト権限 ON オブジェクト名
   TO {ユーザー名 | ロール名 | PUBLIC} [WITH GRANT OPTION];
```

- SQL文を使用したシステム権限の取消し

```SQL
REVOKE システム権限 FROM {ユーザー名 | ロール名 | PUBLIC};
```

- SQL文を使用したオブジェクト権限の取消し

```SQL
REVOKE {オブジェクト権限 | ALL} ON オブジェクト名
  FROM {ユーザー名 | ロール名 | PUBLIC};
```

- ユーザーに`WITH ADMIN OPTION`付きでシステム権限を付与している場合、そのユーザーのシステム権限を取り消しでも、第三者に付与したシステム権限は**取消しできません**。

- `WITH GRANT OPTION`が指定されているオブジェクト権限を取り消し場合、第三者に付与したオブジェクト権限も**同時に取り消しされる**。

**ロールの作成および管理　★★★★**

- `ロール`は `権限`や他の `ロール`の集合で、複数の `権限`や`ロール`をグループ化することにより、ユーザーに容易に`権限`や`ロール`を付与することができる。

- 管理者が作成する`ロール`以外に、事前設定された`ロール`もある。

- `SYSユーザー`や`SYSTEMユーザー`としてデータベースに接続すると、`DBAロール`が付与されている(事前設定定義された)。

- `EM Express`を使用した`ロール`の作成と変更できます。

## リンク

- [ディレクトリ](./../directory.md)

- 前章：[第六章 データベース記憶域構造の管理](Chapter06.md)

- 次章：[第八章 スキーマオブジェクトの管理](Chapter08.md)
