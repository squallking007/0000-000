# 第十章 データベースの監視およびアドバイザの使用

## 10.1 Oracle自己監視アーキテクチャ

**Oracle自己診断エンジン　★★★★**

- Oracleデータベースには、`ADDM(自動データベース診断モニター)`と呼ばれる自己診断エンジンが搭載されている。

- `ADDM`は、データベース自身によって自動的に実行されている。

- `ADDM`によるパフォーマンス診断は「メトリック」に基づいて行われる。

- `メトリック`とは「すでに定義されている特定のシステム属性の統計セット」。

- `EM Express`を使用すると、データベースの状態やワークロードを監視できる。

## 10.2 パフォーマンスの問題の診断

**AWR(自動ワークロードリポジトリ)　★★★**

- Oracleデータベースは、データベースの状態とワークロードの情報を、定期的に`スナップショット`の形式で収集している。

- `スナップショット`は、SYSAUX表領域にある`AWR(自動ワークロードリポジトリ)`に格納される。

- `AWR`は、データベースの使用状況の履歴をデータベースに提供する情報源となっている。

- `スナップショット`の間隔は`Enterprise Manager Cloud Control`や`PL/SQLパッケージ`で変更できる。

**ADDM(自動データベース診断モニター)　★★★**

- `ADDM(自動データベース診断モニター)`は「データベース全体のアドバイザ」といえる機能です。

- `ADDM`は、`AWR`によって`スナップショット`が取得された後、それを元に６０分ごとにトップダウンシステム分析を行い、分析結果を`AWR`に格納する。

**アドバイザの使用　★★★**

- データベースでは、`アドバイザ`によって、さまざまなデータベース管理の問題の解決に対し、適切な`アドバイス`が提供される。

- `ADDM`はデータベース全体についての`アドバイザ`である。

- `パフォーマンスアドバイザ`には、`ADDM`、`SQLチューニングアドバイザ`、`メモリーアドバイザ`、`SGAアドバイザ`、`PGAアドバイザ`、`バッファキャッシュアドバイザ`などがある。

- `パフォーマンス`以外の`アドバイザ`として分類されるものとして、`セグメントアドバイザ`、`UNDOアドバイザ`、`MTTRアドバイザ`などがある。

**SQLチューニングアドバイザ　★★★**

- `SQLチューニングアドバイザ`は負荷の大きなSELECT文を選択し、そのSELECT文の推奨事項には次の４つがある

  + SQL文プロファイルの作成または変更

  + 新しい索引の作成

  + オプティマイザ統計のリフレッシュ

  + SQLの最構築

- 自動`SQLチューニングアドバイザ`はシステムメンテナンスタスクとして、自動的に実行される`アドバイザ`である、

- 自動`SQLチューニングアドバイザ`が生成するアドバイスのうち、SQLプロファイルは自動実装が可能である。

**メモリー関連のアドバイザ　★★★**

- 自動メモリー管理、自動共有メモリー管理、手動共有メモリー管理のそれぞれでメモリー関連の各種アドバイザを起動してメモリーサイズのアドバイザを得ることができる。

- メモリー管理と使用できるアドバイザ

|メモリー管理モード |使用できるアドバイザ |
|---- |---- |
|自動メモリー管理(推奨) |メモリーアドバイザ |
|自動共有メモリー管理　＋　自動PGAメモリー管理<br>(自動メモリー管理は無効) |SGAアドバイザ<br>PGAアドバイザ |
|手動共有メモリー管理　＋　自動PGAメモリー管理<br>(自動メモリー管理、自動共有メモリー管理は無効) |場ふぁキャッシュアドバイザ<br>PGAアドバイザ |

## リンク

- [ディレクトリ](./../directory.md)

- 前章：[第九章 バックアップおよびリカバリの実行](Chapter09.md)

- 次章：[第十一章 Oracleデータベースソフトウェアの管理](Chapter11.md)
