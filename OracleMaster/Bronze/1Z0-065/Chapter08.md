# 第八章 スキーマオブジェクトの管理

## 8.1 スキーマオブジェクトの概要と表の管理

**スキーマとスキーマオブジェクト　★★★★**

- ユーザーアカウントを作成すると、ユーザーの「`スキーマ`」も同時に、かつ**同じ名前**で作成される。

- `スキーマ`は、データベースオブジェクトの集合であり、オブジェクトを管理する際に枠組み。

- `スキーマ`に属するオブジェクトを`スキーマオブジェクト`という。

- `スキーマ`はユーザーによって所有される。

- `スキーマ名`はユーザー名と同じ名前である。

- データベース作成時に自動的に作成される`スキーマ`に「**SYS**」と「**SYSTEM**」がある。

|スキーマ名 |説明 |
|---- |---- |
|SYS |**データディクショナリを構成するすべての実表およびビュー**が作成されるスキーマ。 |
|SYSTEM |**管理情報を格納するための追加の表やビュー、およびOracle製品のオプションやツールで使用される内部的な表やビュー**が作成されるスキーマ。 |

- 自分が所有している`スキーマオブジェクト`以外の`スキーマオブジェクト`にアクセスするには、ユーザに`オブジェクト権限`が付与されている必要がある。

- オブジェクト名を付ける場合は次の命名規則に従う。
  + 長さは３０バイト以下(文字数ではなく、バイト数)
  + 先頭の文字は数字以外の文字(数字および記号不可)
  + 使用できる文字は、英数字および漢字、カタカナ、ひらかな
  + 使用できる記号は「_」、「$」、「#」３種類のみ。
  + 同一のスキーマ内で重複する名前は指定できない。
  + OracleのSQLにおける予約語は使用できない。
  + アルファバイトの大文字・小文字は区別されない。

**表の作成　★★★★**

- `表`はデータベースにおける**データ格納の基本単位**です。

- `表`には`列`と`行`があり、各`列`に対して**データ型**を指定する必要がある。`列`に対して**整合性制約**を設定することで、`列`の入力値を制限することができる。

- 主なOracleデータベースの組込みデータ型

|データ型 |固定長／可変長 |説明 |
|---- |---- |---- |
|CHAR(n) |固定長文字型 |長さがnバイトの固定長の文字データ。<br>**最大サイズは2000バイト、最小サイズは１バイト** |
|VARCHAR2(n) |可変長文字型 |最大長がnバイトまたはn文字の可変長文字データ<br>**最大サイズは4000バイト、最小サイズは１バイトまたは１文字** |
|DATE |固定長日付型 |**日付と時刻**の情報が格納されるデータ型。 |
|NUMBER(p,s) |可変長数字型 |精度がp、位取りがsの数値データ型。 |

- `整合性制約`とは、**列に格納されるデータを制限するルール**です。

|制限 |SQL上での表記 |説明 |
|---- |---- |---- |
|NOT NULL |NOT NULL |値がNULLになることを禁止する |
|一意キー |UNIQUE |複数の行で、同じ列または列の組合せで同じ値を持つことを禁止する。<br>値がNULLになることは許可される。複数設定できる。 |
|主キー |PRIMARY KEY |NOT NULL と一意キーが組み合わされるのと同じ動作になる。<br>最大１つ設定できる。 |
|外部キー |FOREIGN KEY |複数の表を関連付けるための共通する列。**参照整合性制約**とも呼びばれる。 |
|チェック |CHECK |データベースの値が指定された条件を満たすようにする。 |

- SQL文を使用した表の作成

```SQL
// 表の作成
CREATE TABLE [スキーマ名.]表名
(
    列名    データ型
    [,列名  データ型...]
);
```

```SQL
// 既存の表の複製
CREATE TABLE 表名 [(列名[,　列名...])]
AS SELECT文;
```

**表の変更　★★**

- `表`に対して、次のような変更作業を実行できます。

  + 表に新しい列を追加する

  + 既存の列のデータ型を変更する

  + 既存の列にデフォルト値を設定する

  + 既存の列を削除する

  + 既存の列の名前を変更する

  + 表を読取り／書込みモードにする

  + 表を読取り専用モードにする

- SQL文を使用した表の変更

```SQL
// 列の追加
ALTER TABLE 表名
ADD (
    列名    データ型    [DEFAULT 式] [列ラベル制約]
    [, 列名 データ型    [DEFAULT 式] [列ラベル制約]...]
);
```

```SQL
// 列ラベル制約の基本構文
列名    [CONSTRAINT    制約名]    制約
```

```SQL
// 表ラベル制約の基本構文
[CONSTRAINT 制約名]    制約    (列名  [, 列名...])
```

```SQL
// 既存の列のデータ型を変更
ALTER TABLE 表名
MODIFY (
    列名    データ型    [DEFAULT 式]
    [, 列名 データ型    [DEFAULT 式]...]
);
```
```SQL
// 制約の追加
ALTER TABLE 表名 ADD 表ラベル制約構文;
```
- 制約は列ラベルまたは表ラベルで定義できる。

**表の削除　★★★★**

- 表を削除すると、表内の**データ**、表に定義される**制約**や**索引**、**表の定義情報**も削除される。参照する`ビュー`や`シノニム`を**無効**になる。

- 表を削除できるのは、**表の所有者**または**DROP ANY TABLE権限**を持つユーザーのみです。

- 削除した表はデフォルトでは`ごみ箱`に入ります。リカバリできます。

- 表の削除により実行される処理は次の通りです。

  + 表の定義がデータディクショナリ殻削除される。

  + 表のすべての行が削除される。

  + 表に定義されているすべての索引が削除される。

  + 表を削除すると既定でごみ箱に入る。

- SQL文を使用した表の削除

``` SQL
DROP TABLE 表名
```

## 8.2 スキーマオブジェクトの追加作成










